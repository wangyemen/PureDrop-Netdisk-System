# PureDrop网盘系统

一个功能完整的PHP网盘系统，支持文件上传、下载、分享、预览等功能。

## 功能特性

### 用户功能
- 用户注册、登录、退出
- 邮箱验证（支持SMTP邮件发送验证码）
- 个人资料管理（头像、昵称、密码修改）
- 存储空间管理
- 响应式设计（支持移动端访问）

### 文件管理
- 文件上传（支持分片上传、断点续传）
- 文件下载（单文件下载、批量下载打包为ZIP）
- 文件夹管理（新建、移动、重命名、复制、删除）
- 文件搜索（按文件名搜索）
- 文件排序（按名称、大小、修改时间）
- 文件筛选（按类型：图片、视频、音乐、文档）
- 网格/列表视图切换
- 右键菜单操作

### 在线预览
- 图片预览（支持常见图片格式）
- 视频预览（支持流式传输）
- 音频预览（支持流式传输）

### 分享功能
- 文件/文件夹分享
- 提取码设置
- 有效期设置
- 分享链接生成
- 未登录用户可查看分享内容
- 保存分享文件到我的网盘

### 管理后台
- 仪表盘（数据统计、图表展示）
- 用户管理（查看、禁用、重置密码、分配存储空间）
- 系统设置
  - 基础配置（网站名称、Logo、URL、注册开关）
  - 安全配置（登录尝试次数、验证码）
  - 分享设置（有效期、提取码）
  - 文件设置（最大文件大小）
  - 邮件设置（SMTP配置、邮箱验证开关）
- 存储方案管理（自定义免费和付费方案）
- 公告管理
- 操作日志
- 管理员日志
- 一键删除所有数据

## 安装说明

### 环境要求
- PHP >= 7.4
- MySQL >= 5.7
- 必需扩展：mysqli, gd, mbstring

### 安装步骤

1. 上传所有文件到服务器

2. 访问 `http://yourdomain.com/install/install.php`

3. 按照安装向导完成安装：
   - 环境检查
   - 数据库配置
   - 安装数据库
   - 管理员设置

4. 安装完成后，删除 `install` 目录

5. 使用管理员账户登录系统

## 邮箱验证配置

### SMTP设置
在管理后台的"系统设置"页面，配置以下SMTP信息：

1. **SMTP服务器**：例如 smtp.qq.com、smtp.163.com
2. **SMTP端口**：通常为 465（SSL）或 587（TLS）
3. **SMTP用户名**：您的邮箱地址
4. **SMTP密码**：SMTP授权码（不是邮箱密码）
5. **发件人邮箱**：发送邮件的邮箱地址
6. **发件人名称**：例如 "PureDrop网盘"
7. **加密方式**：SSL 或 TLS
8. **启用邮箱验证**：设置为"是"来启用邮箱验证功能
9. **验证码有效期**：验证码的有效时间（分钟）

### 获取SMTP授权码
不同邮箱服务商获取授权码的方式：

**QQ邮箱**：
1. 登录QQ邮箱网页版
2. 点击"设置" → "账户"
3. 找到"POP3/IMAP/SMTP/Exchange/CardDAV/CalDAV服务"
4. 开启"POP3/SMTP服务"
5. 按照提示发送短信获取授权码

**163邮箱**：
1. 登录163邮箱网页版
2. 点击"设置" → "POP3/SMTP/IMAP"
3. 开启"POP3/SMTP服务"
4. 按照提示获取授权码

### 用户注册流程
1. 用户访问注册页面
2. 输入用户名和邮箱
3. 点击"发送验证码"按钮
4. 系统发送6位数字验证码到用户邮箱
5. 用户输入验证码完成注册
6. 验证码有效期为10分钟（可配置）

## 目录结构

```
puredrop.xo.je/
├── admin/              # 管理后台
│   ├── api.php        # 管理后台API
│   ├── index.php      # 管理后台首页
│   └── pages/        # 管理后台页面
├── api/               # API接口
│   ├── batch_download.php  # 批量下载
│   ├── files.php      # 文件管理API
│   ├── send_code.php  # 验证码发送API
│   ├── share.php      # 分享API
│   └── upload.php    # 上传API
├── assets/            # 静态资源
│   ├── css/          # 样式文件
│   ├── js/           # JavaScript文件
│   └── images/       # 图片资源
├── config/            # 配置文件
│   └── config.php    # 系统配置（安装后生成）
├── core/              # 核心文件
│   ├── functions.php # 公共函数
│   └── mail.php      # 邮件发送功能
├── includes/          # 包含文件
│   ├── auth.php      # 认证检查
│   ├── footer.php    # 页脚
│   └── header.php    # 页头
├── install/           # 安装程序
│   ├── database.sql  # 数据库结构
│   └── install.php   # 安装向导
├── uploads/           # 上传文件目录
├── admin/             # 管理后台入口
├── download.php       # 文件下载
├── index.php          # 首页
├── login.php          # 登录页
├── logout.php         # 退出登录
├── preview.php        # 文件预览
├── profile.php        # 个人资料
├── recycle.php        # 回收站
├── register.php       # 注册页
├── share.php          # 我的分享
└── share_view.php     # 分享查看页
```

## 使用说明

### 用户操作
1. 注册账户（如启用邮箱验证，需要验证邮箱）
2. 登录系统
3. 上传文件
4. 管理文件（新建文件夹、移动、重命名、删除等）
5. 分享文件
6. 预览文件

### 管理员操作
1. 使用管理员账户登录
2. 进入管理后台
3. 配置SMTP邮件设置（如需启用邮箱验证）
4. 管理用户、系统设置、存储方案等
5. 定期检查系统更新（管理后台右上角显示版本号和检查更新按钮）

## 版本更新

### 自动检查
- 系统会在管理后台加载时自动检查最新版本
- 如果发现新版本，会弹出提示窗口
- 点击"立即更新"按钮跳转到官网下载最新版本
- 点击"稍后提醒"可以暂时关闭提示（使用localStorage记住）

### 手动检查
- 在管理后台右上角点击"🔄 检查更新"按钮
- 系统会立即检查最新版本
- 如果已是最新版本，会显示"当前已是最新版本"提示
- 如果有新版本，会弹出更新提示窗口

### 版本号显示
- 管理后台右上角显示当前版本号（如 v1.2.0）
- 如果有新版本可用，会显示红色"有新版本"标签
- 版本信息从本地version.txt文件读取
- 最新版本信息从GitHub仓库获取

## 安全建议

1. 安装完成后删除 `install` 目录
2. 定期备份数据库和上传文件
3. 使用强密码
4. 定期更新系统
5. 配置正确的文件权限
6. 不要在代码中硬编码敏感信息
7. 定期检查操作日志

## 技术支持

如有问题，请联系技术支持。

### 常见问题

**Q: Logo上传后不显示怎么办？**
A: 请确保uploads目录有写入权限，并且文件格式正确（支持常见图片格式）。

**Q: 网站名称修改后不生效怎么办？**
A: 请确保在系统设置中保存了修改，然后刷新页面查看效果。

**Q: 如何修改默认存储空间？**
A: 在管理后台的系统设置中修改默认存储空间设置。

**Q: 邮件发送失败怎么办？**
A: 请检查以下配置：
1. SMTP服务器地址是否正确
2. SMTP端口是否正确（SSL通常用465，TLS通常用587）
3. SMTP用户名和密码是否正确（注意是授权码，不是邮箱密码）
4. 加密方式是否选择正确
5. 发件人邮箱是否配置

**Q: 如何启用邮箱验证功能？**
A: 在管理后台的系统设置中，找到"邮件设置"部分，将"启用邮箱验证"设置为"是"，然后保存设置。

**Q: 验证码发送后收不到邮件怎么办？**
A: 请检查：
1. 邮箱地址是否正确
2. 邮箱是否在垃圾箱中
3. SMTP配置是否正确
4. 查看服务器错误日志

**Q: 验证码有效期可以修改吗？**
A: 可以。在管理后台的系统设置中，找到"验证码有效期"选项，修改分钟数即可。

**Q: 如何获取QQ邮箱的SMTP授权码？**
A: 
1. 登录QQ邮箱网页版
2. 点击"设置" → "账户"
3. 找到"POP3/IMAP/SMTP/Exchange/CardDAV/CalDAV服务"
4. 开启"POP3/SMTP服务"
5. 按照提示发送短信获取授权码

**Q: 预览图片时右侧有空白怎么办？**
A: 这个问题已经修复，预览图片现在会自动居中显示，不会有多余的空白区域。

**Q: 设置保存时出现500错误怎么办？**
A: 请检查：
1. 数据库连接是否正常
2. system_settings表是否存在
3. 查看服务器错误日志获取详细信息

## 更新日志

### v1.2.0 (2026-02-25)
- 新增版本检查功能
- 新增自动更新提醒弹窗
- 新增手动检查更新按钮
- 在管理后台显示当前版本号
- 优化版本比较逻辑
- 修复设置数据类型问题
- 修复邮箱验证功能显示问题

### v1.1.0 (2026-02-25)
- 新增邮箱验证功能
- 新增SMTP邮件配置
- 新增验证码发送和验证机制
- 新增邮件模板系统
- 修复预览模态框样式问题
- 修复设置保存时的500错误
- 优化用户体验

### v1.0.0
- 初始版本发布
- 基础文件管理功能
- 分享功能
- 在线预览功能
- 管理后台功能
